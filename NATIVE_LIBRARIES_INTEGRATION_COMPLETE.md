# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ç–∏–≤–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

**–î–∞—Ç–∞:** 2025-01-27
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏

### ‚úÖ –®–∞–≥ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ build.gradle.kts

–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∞–π–ª `core/network/build.gradle.kts` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è cinterop –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤–æ –≤—Å–µ desktop target'—ã:

- **linuxX64** - –¥–æ–±–∞–≤–ª–µ–Ω—ã cinterop –¥–ª—è video_processing, analytics, codecs
- **macosX64** - –¥–æ–±–∞–≤–ª–µ–Ω—ã cinterop –¥–ª—è video_processing, analytics, codecs
- **macosArm64** - –¥–æ–±–∞–≤–ª–µ–Ω—ã cinterop –¥–ª—è video_processing, analytics, codecs
- **mingwX64 (Windows)** - –¥–æ–±–∞–≤–ª–µ–Ω—ã cinterop –¥–ª—è video_processing, analytics, codecs

–ö–∞–∂–¥—ã–π target —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:
```kotlin
val videoProcessing by creating {
    defFile(project.file("src/nativeInterop/cinterop/video_processing.def"))
    compilerOpts("-I${project.rootDir}/../native/video-processing/include")
    includeDirs("${project.rootDir}/../native/video-processing/include")
    linkerOpts("-L${project.rootDir}/../native/video-processing/lib/{platform}/{arch} -lvideo_processing")
}

val analytics by creating {
    defFile(project.file("src/nativeInterop/cinterop/analytics.def"))
    compilerOpts("-I${project.rootDir}/../native/analytics/include")
    includeDirs("${project.rootDir}/../native/analytics/include")
    linkerOpts("-L${project.rootDir}/../native/analytics/lib/{platform}/{arch} -lanalytics")
}

val codecs by creating {
    defFile(project.file("src/nativeInterop/cinterop/codecs.def"))
    compilerOpts("-I${project.rootDir}/../native/codecs/include")
    includeDirs("${project.rootDir}/../native/codecs/include")
    linkerOpts("-L${project.rootDir}/../native/codecs/lib/{platform}/{arch} -lcodecs")
}
```

### ‚úÖ –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

–°–æ–∑–¥–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫:

```
native/
‚îú‚îÄ‚îÄ build/                          (—Å–æ–∑–¥–∞–Ω–∞)
‚îú‚îÄ‚îÄ video-processing/
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îú‚îÄ‚îÄ linux/x64/              (—Å–æ–∑–¥–∞–Ω–∞)
‚îÇ       ‚îú‚îÄ‚îÄ macos/x64/              (—Å–æ–∑–¥–∞–Ω–∞)
‚îÇ       ‚îú‚îÄ‚îÄ macos/arm64/            (—Å–æ–∑–¥–∞–Ω–∞)
‚îÇ       ‚îî‚îÄ‚îÄ windows/x64/            (—Å–æ–∑–¥–∞–Ω–∞)
‚îú‚îÄ‚îÄ analytics/
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îú‚îÄ‚îÄ linux/x64/              (—Å–æ–∑–¥–∞–Ω–∞)
‚îÇ       ‚îú‚îÄ‚îÄ macos/x64/              (—Å–æ–∑–¥–∞–Ω–∞)
‚îÇ       ‚îú‚îÄ‚îÄ macos/arm64/            (—Å–æ–∑–¥–∞–Ω–∞)
‚îÇ       ‚îî‚îÄ‚îÄ windows/x64/            (—Å–æ–∑–¥–∞–Ω–∞)
‚îî‚îÄ‚îÄ codecs/
    ‚îî‚îÄ‚îÄ lib/
        ‚îú‚îÄ‚îÄ linux/x64/              (—Å–æ–∑–¥–∞–Ω–∞)
        ‚îú‚îÄ‚îÄ macos/x64/              (—Å–æ–∑–¥–∞–Ω–∞)
        ‚îú‚îÄ‚îÄ macos/arm64/            (—Å–æ–∑–¥–∞–Ω–∞)
        ‚îî‚îÄ‚îÄ windows/x64/            (—Å–æ–∑–¥–∞–Ω–∞)
```

### ‚úÖ –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å–±–æ—Ä–∫–∏

–°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö:

1. **`scripts/build-all-native-libs.sh`** - –¥–ª—è Linux/macOS
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: linux, macos, windows, all
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â—É—é –û–°
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (CMake, FFmpeg, OpenCV)

2. **`scripts/build-all-native-libs.ps1`** - –¥–ª—è Windows
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ CMake, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ (GCC/MSVC)
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã (Ninja, MinGW, Visual Studio)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä—É–µ—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

1. **.def —Ñ–∞–π–ª—ã** - —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
2. **Gradle –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è desktop –ø–ª–∞—Ç—Ñ–æ—Ä–º
3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π** - —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
4. **–°–∫—Ä–∏–ø—Ç—ã —Å–±–æ—Ä–∫–∏** - —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
5. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–¥–µ–∫–æ–≤** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–∞

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Å–±–æ—Ä–∫–∏:

–ù–∞—Ç–∏–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–±—Ä–∞—Ç—å –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:

**Linux/macOS:**
```bash
./scripts/build-all-native-libs.sh all
```

**Windows:**
```powershell
.\scripts\build-all-native-libs.ps1
```

### üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è:

1. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏:**
   - CMake >= 3.15
   - C++ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä (GCC, Clang, MSVC)
   - FFmpeg (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   - OpenCV (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è analytics)

2. **Android/iOS targets:**
   - –î–ª—è Android/iOS cinterop —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è rtsp_client
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏:**
   - –ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `.so` (Linux), `.dylib` (macOS) –∏–ª–∏ `.dll` (Windows) —Ñ–∞–π–ª–æ–≤
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö

## –°–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

### –î–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

1. **–°–æ–±—Ä–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:**
   ```bash
   # Linux/macOS
   ./scripts/build-all-native-libs.sh all

   # Windows
   .\scripts\build-all-native-libs.ps1
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É:**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç —Å–∏–º–≤–æ–ª–æ–≤ (–¥–ª—è Linux: `nm -D`, –¥–ª—è macOS: `nm -gU`)

3. **–î–æ–±–∞–≤–∏—Ç—å –≤ CI/CD:**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–±–æ—Ä–∫—É –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ª–∏—á–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤ —Ç–µ—Å—Ç–∞—Ö

4. **–°–æ–∑–¥–∞—Ç—å Kotlin –æ–±–µ—Ä—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - –£–¥–æ–±–Ω—ã–µ –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–∑ Kotlin –∫–æ–¥–∞
   - –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
core/network/
‚îú‚îÄ‚îÄ build.gradle.kts                    (–æ–±–Ω–æ–≤–ª–µ–Ω - –¥–æ–±–∞–≤–ª–µ–Ω—ã cinterop)
‚îî‚îÄ‚îÄ src/nativeInterop/cinterop/
    ‚îú‚îÄ‚îÄ rtsp_client.def                 (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
    ‚îú‚îÄ‚îÄ video_processing.def            (–Ω–æ–≤—ã–π)
    ‚îú‚îÄ‚îÄ analytics.def                    (–Ω–æ–≤—ã–π)
    ‚îî‚îÄ‚îÄ codecs.def                        (–Ω–æ–≤—ã–π)

native/
‚îú‚îÄ‚îÄ build/                               (—Å–æ–∑–¥–∞–Ω–∞)
‚îú‚îÄ‚îÄ video-processing/
‚îÇ   ‚îú‚îÄ‚îÄ CMakeLists.txt
‚îÇ   ‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ lib/                             (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞)
‚îú‚îÄ‚îÄ analytics/
‚îÇ   ‚îú‚îÄ‚îÄ CMakeLists.txt
‚îÇ   ‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ lib/                             (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞)
‚îî‚îÄ‚îÄ codecs/
    ‚îú‚îÄ‚îÄ CMakeLists.txt                   (–æ–±–Ω–æ–≤–ª–µ–Ω)
    ‚îú‚îÄ‚îÄ include/
    ‚îÇ   ‚îú‚îÄ‚îÄ h264_codec.h                 (–æ–±–Ω–æ–≤–ª–µ–Ω)
    ‚îÇ   ‚îú‚îÄ‚îÄ h265_codec.h                 (–æ–±–Ω–æ–≤–ª–µ–Ω)
    ‚îÇ   ‚îî‚îÄ‚îÄ mjpeg_codec.h                (–æ–±–Ω–æ–≤–ª–µ–Ω)
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îú‚îÄ‚îÄ h264_codec.cpp               (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
    ‚îÇ   ‚îú‚îÄ‚îÄ h265_codec.cpp               (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
    ‚îÇ   ‚îú‚îÄ‚îÄ mjpeg_codec.cpp              (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
    ‚îÇ   ‚îî‚îÄ‚îÄ codec_manager.cpp            (–æ–±–Ω–æ–≤–ª–µ–Ω)
    ‚îî‚îÄ‚îÄ lib/                             (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞)

scripts/
‚îú‚îÄ‚îÄ build-all-native-libs.sh             (–Ω–æ–≤—ã–π - Linux/macOS)
‚îî‚îÄ‚îÄ build-all-native-libs.ps1            (–Ω–æ–≤—ã–π - Windows)
```

## –ò—Ç–æ–≥

–í—Å–µ —Ç—Ä–∏ –ø—Ä–æ–±–ª–µ–º—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã:

1. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kotlin/Native** - —Å–æ–∑–¥–∞–Ω—ã .def —Ñ–∞–π–ª—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω build.gradle.kts
2. ‚úÖ **–°–±–æ—Ä–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫** - —Å–æ–∑–¥–∞–Ω—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã —Å–±–æ—Ä–∫–∏
3. ‚úÖ **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–¥–µ–∫–æ–≤** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–∞

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Å–±–æ—Ä–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–∞—Ç–∏–≤–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫!

