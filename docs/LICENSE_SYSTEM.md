# Система лицензирования

## Обзор

Система лицензирования IP-CSS использует двухкомпонентную модель:
1. **XML лицензия** - подписанная цифровой подписью
2. **Активационный код** - привязка к устройству/устройствам

## Типы лицензий

### Trial (Триальная)
- Максимум 1 камера
- Запись до 10 минут непрерывно
- Водяной знак на видео
- Без аналитики и ANPR
- Срок действия 30 дней

### Business (Бизнес)
- До 8 камер
- Непрерывная запись
- Базовая аналитика
- Срок действия 1 год

### Enterprise (Корпоративная)
- До 16+ камер
- Полная аналитика и ANPR
- Облачное хранилище
- Множественные пользователи
- API доступ
- Поддержка 24/7

## Активация

### Онлайн активация

1. Получите лицензию и активационный код
2. Откройте приложение
3. Перейдите в "Настройки" → "Лицензия"
4. Введите XML лицензию и активационный код
5. Нажмите "Активировать"

### Офлайн активация

1. Запросите офлайн-код через веб-кабинет
2. Получите код формата: `OFA-XXXX-XXXX-XXXX`
3. В приложении выберите "Офлайн активация"
4. Введите офлайн-код
5. Лицензия будет активирована на 30 дней

## Перенос лицензии

### Смена устройства

1. На старом устройстве: "Настройки" → "Лицензия" → "Перенести"
2. Получите код переноса
3. На новом устройстве введите код переноса
4. Лицензия будет активирована на новом устройстве

## Проверка лицензии

Система автоматически проверяет лицензию:
- При запуске приложения
- Периодически (раз в день)
- При использовании функций, требующих лицензии

## Ограничения

### По количеству камер
- Trial: 1 камера
- Business: 8 камер
- Enterprise: 16+ камер

### По функциям
- Trial: базовые функции
- Business: базовая аналитика
- Enterprise: все функции

### По времени
- Trial: 30 дней
- Business: 1 год
- Enterprise: 1 год или бессрочно

## Восстановление

### Потеря лицензии

Если лицензия была потеряна:
1. Обратитесь в поддержку
2. Предоставьте информацию о покупке
3. Получите новую лицензию

### Проблемы с активацией

Если возникают проблемы:
1. Проверьте подключение к интернету
2. Убедитесь, что код введен правильно
3. Проверьте срок действия лицензии
4. Обратитесь в поддержку

## Безопасность

- Лицензии защищены криптографически
- Привязка к устройству через аппаратные ключи
- Регулярная проверка отозванных лицензий
- Защита от взлома и модификации

## Статус реализации

**Текущий прогресс:** ~20%

**Реализовано:**
- ✅ Базовая структура LicenseManager
- ✅ Модели данных (License, ActivatedLicense, etc.)
- ✅ Валидация лицензии при запуске (базовая)
- ✅ Проверка доступности функций
- ⚠️ Платформо-специфичные реализации (частично - используют временные решения)

**Не реализовано:**
- ❌ Онлайн активация (HTTP запрос к серверу, парсинг XML, проверка подписи)
- ❌ Офлайн активация (расшифровка кода, валидация)
- ❌ Проверка целостности (проверка подписи и хеша)
- ❌ Полная реализация платформо-специфичных хранилищ (Android Keystore, iOS Keychain)

**Детальный анализ нереализованного функционала:** [MISSING_FUNCTIONALITY.md](MISSING_FUNCTIONALITY.md#licensemanager)
**Руководство по интеграции:** [INTEGRATION_GUIDE.md](INTEGRATION_GUIDE.md#5-криптография-для-лицензирования)
**Разделение разработки по платформам:** [PLATFORMS.md](PLATFORMS.md)
**API документация:** [API.md](API.md#лицензии-apiv1license)

