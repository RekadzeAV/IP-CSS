# –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** –Ø–Ω–≤–∞—Ä—å 2025
**–í–µ—Ä—Å–∏—è:** Alfa-0.0.1

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Rate Limiting ‚úÖ

**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –£–ª—É—á—à–µ–Ω `RateLimitMiddleware` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoints
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ `X-RateLimit-Limit`, `X-RateLimit-Remaining`, `X-RateLimit-Reset` –≤ –æ—Ç–≤–µ—Ç—ã
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å—Ç—Ä–æ–≥–∏–µ –ª–∏–º–∏—Ç—ã:
  - Login: 5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç
  - Registration: 3 –ø–æ–ø—ã—Ç–∫–∏ / —á–∞—Å
  - –û–±—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ / –º–∏–Ω—É—Ç—É
- –ü—Ä–∏–º–µ–Ω–µ–Ω –∫ login endpoint

**–§–∞–π–ª—ã:**
- `server/api/src/main/kotlin/com/company/ipcamera/server/middleware/RateLimitMiddleware.kt`
- `server/api/src/main/kotlin/com/company/ipcamera/server/routing/AuthRoutes.kt`

---

### 2. JWT —Ç–æ–∫–µ–Ω—ã –≤ httpOnly cookies ‚úÖ

**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –û–±–Ω–æ–≤–ª–µ–Ω login endpoint –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ –≤ httpOnly cookies
- –û–±–Ω–æ–≤–ª–µ–Ω refresh endpoint –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cookies
- –û–±–Ω–æ–≤–ª–µ–Ω logout endpoint –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è cookies
- –°–æ–∑–¥–∞–Ω middleware –¥–ª—è —á—Ç–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ cookies
- –¢–æ–∫–µ–Ω—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —Ç–µ–ª–µ –æ—Ç–≤–µ—Ç–∞ (—Ç–æ–ª—å–∫–æ –≤ cookies)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ñ–ª–∞–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
  - `httpOnly: true` - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
  - `secure: true` (–≤ production) - —Ç–æ–ª—å–∫–æ HTTPS
  - `sameSite: Lax` - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF

**–§–∞–π–ª—ã:**
- `server/api/src/main/kotlin/com/company/ipcamera/server/middleware/CookieAuthMiddleware.kt`
- `server/api/src/main/kotlin/com/company/ipcamera/server/routing/AuthRoutes.kt`
- `server/api/src/main/kotlin/com/company/ipcamera/server/Application.kt`

**–û—Å—Ç–∞–ª–æ—Å—å:**
- –û–±–Ω–æ–≤–∏—Ç—å –≤–µ–±-–∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cookies (—É–±—Ä–∞—Ç—å localStorage)

---

### 3. RBAC (Role-Based Access Control) ‚úÖ

**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –£–ª—É—á—à–µ–Ω `AuthorizationMiddleware` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
  - –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π (ADMIN > OPERATOR > VIEWER > GUEST)
  - –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (permissions)
  - Wildcard —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π ("*" –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∞–≤)
  - –ü—Ä–æ–≤–µ—Ä–∫–∏ –ª—é–±–æ–≥–æ –∏–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (requireAnyPermission)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∫ –º–∞—Ä—à—Ä—É—Ç–∞–º:
  - DELETE –∫–∞–º–µ—Ä—ã - —Ç–æ–ª—å–∫–æ ADMIN
  - POST/PUT –∫–∞–º–µ—Ä—ã - OPERATOR –∏–ª–∏ –≤—ã—à–µ
  - GET –∫–∞–º–µ—Ä—ã - –≤—Å–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ - —Ç–æ–ª—å–∫–æ ADMIN
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ - —Ç–æ–ª—å–∫–æ ADMIN

**–†–æ–ª–∏:**
- `ADMIN` - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º
- `OPERATOR` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–∞–º–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
- `VIEWER` - —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
- `GUEST` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø

**–§–∞–π–ª—ã:**
- `server/api/src/main/kotlin/com/company/ipcamera/server/middleware/AuthorizationMiddleware.kt`
- `server/api/src/main/kotlin/com/company/ipcamera/server/routing/CameraRoutes.kt`
- `server/api/src/main/kotlin/com/company/ipcamera/server/routing/UserRoutes.kt`
- `server/api/src/main/kotlin/com/company/ipcamera/server/routing/SettingsRoutes.kt`

---

### 4. Security Headers –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ ‚úÖ

**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω—ã Security Headers –≤ `next.config.js`:
  - `X-Content-Type-Options: nosniff` - –∑–∞—â–∏—Ç–∞ –æ—Ç MIME type sniffing
  - `X-Frame-Options: DENY` - –∑–∞—â–∏—Ç–∞ –æ—Ç clickjacking
  - `X-XSS-Protection: 1; mode=block` - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
  - `Referrer-Policy: strict-origin-when-cross-origin` - –∫–æ–Ω—Ç—Ä–æ–ª—å referrer
  - `Permissions-Policy` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ API –±—Ä–∞—É–∑–µ—Ä–∞
  - `Strict-Transport-Security` - HSTS (—Ç–æ–ª—å–∫–æ –≤ production)
  - `Content-Security-Policy` - –ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  - `X-DNS-Prefetch-Control: on` - –∫–æ–Ω—Ç—Ä–æ–ª—å DNS prefetch

**–§–∞–π–ª—ã:**
- `server/web/next.config.js`

---

## ‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ / –û—Å—Ç–∞–ª–æ—Å—å

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cookies

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
- –£–±—Ä–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ localStorage
- –û–±–Ω–æ–≤–∏—Ç—å axios interceptor –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cookies (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –û–±–Ω–æ–≤–∏—Ç—å Redux store –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API
- –û–±–Ω–æ–≤–∏—Ç—å authService –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cookies

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `server/web/src/utils/api.ts`
- `server/web/src/services/authService.ts`
- `server/web/src/store/slices/authSlice.ts`

---

### 2. SSL/TLS Certificate Pinning

**–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å certificate pinning –¥–ª—è Android
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å certificate pinning –¥–ª—è iOS
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å certificate pinning –¥–ª—è Desktop/JVM
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ ApiClient

---

### 3. –£–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
- Android: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Android Keystore –≤–º–µ—Å—Ç–æ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –∫–ª—é—á–µ–π
- iOS: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Keychain Services
- Desktop: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Java KeyStore

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** 4 –∏–∑ 6 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
- **–í –ø—Ä–æ—Ü–µ—Å—Å–µ:** 1 –∑–∞–¥–∞—á–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–∞)
- **–û—Å—Ç–∞–ª–æ—Å—å:** 2 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏

**–ü—Ä–æ–≥—Ä–µ—Å—Å:** ~67% –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –û–±–Ω–æ–≤–∏—Ç—å –≤–µ–±-–∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cookies
2. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å SSL/TLS Certificate Pinning
3. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –£–ª—É—á—à–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –Ø–Ω–≤–∞—Ä—å 2025

