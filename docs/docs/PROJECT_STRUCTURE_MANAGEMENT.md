# Управление структурой проекта

## Обзор

Проект использует автоматическую систему генерации и обновления структуры проекта. Структура проекта автоматически обновляется при каждом коммите и в CI/CD pipeline.

## Автоматически генерируемые файлы

### `PROJECT_STRUCTURE_AUTO.md`

Этот файл содержит актуальную структуру проекта и автоматически генерируется скриптом `scripts/generate-project-structure.py`.

**⚠️ ВАЖНО:** Не редактируйте этот файл вручную! Все изменения будут перезаписаны при следующей генерации.

## Как работает система

### 1. Локальная разработка

При каждом коммите срабатывает pre-commit hook, который:
- Автоматически генерирует структуру проекта
- Проверяет, изменилась ли структура
- Предлагает добавить обновленный файл в коммит

### 2. CI/CD Pipeline

В GitHub Actions настроен job `update-structure`, который:
- Генерирует структуру проекта при каждом push
- Автоматически коммитит изменения в ветку `main`
- Создает комментарий в Pull Request, если структура изменилась

### 3. Ручное обновление

Вы можете вручную обновить структуру проекта:

```bash
python3 scripts/generate-project-structure.py
```

## Установка git hooks

Для автоматической проверки структуры при коммитах установите git hooks:

```bash
./scripts/setup-git-hooks.sh
```

Или вручную скопируйте hook:

```bash
cp scripts/pre-commit .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

## Скрипт генерации структуры

### `scripts/generate-project-structure.py`

Скрипт анализирует структуру проекта и генерирует файл `PROJECT_STRUCTURE_AUTO.md` со следующей информацией:

- **Статистика проекта**: количество файлов, директорий, модулей
- **Статистика по типам файлов**: распределение файлов по расширениям
- **Дерево структуры**: визуальное представление структуры проекта
- **Информация о модулях**: список всех Gradle, CMake и Node.js модулей
- **Описание директорий**: краткое описание основных директорий

### Параметры скрипта

Скрипт автоматически:
- Игнорирует служебные директории (`.git`, `.gradle`, `build`, `node_modules`, и т.д.)
- Показывает только важные файлы и файлы с кодом
- Ограничивает глубину дерева до 5 уровней
- Подсчитывает статистику по всем типам файлов

### Игнорируемые директории и файлы

Следующие директории и файлы автоматически игнорируются:

**Директории:**
- `.git`, `.gradle`, `.idea`, `build`, `node_modules`, `.next`
- `dist`, `out`, `__pycache__`, `.vscode`, `gradle/wrapper`

**Файлы:**
- `.gitignore`, `.DS_Store`, `gradle-wrapper.jar`
- Скомпилированные файлы (`.class`, `.jar`, `.aar`, `.so`, `.dylib`, `.dll`)

## CI/CD интеграция

### GitHub Actions Workflow

В файле `.github/workflows/ci.yml` настроен job `update-structure`, который:

1. **Генерирует структуру** при каждом push
2. **Проверяет изменения** в файле `PROJECT_STRUCTURE_AUTO.md`
3. **Автоматически коммитит** изменения в ветку `main` (только для push в main)
4. **Создает комментарий** в Pull Request, если структура изменилась

### Настройка прав доступа

Для автоматического коммита в GitHub Actions требуется:
- `contents: write` - для коммита изменений
- `pull-requests: write` - для создания комментариев в PR

Эти права уже настроены в workflow файле.

## Ручное обновление структуры

Если вы хотите обновить структуру вручную:

```bash
# 1. Сгенерировать структуру
python3 scripts/generate-project-structure.py

# 2. Проверить изменения
git diff PROJECT_STRUCTURE_AUTO.md

# 3. Добавить в коммит
git add PROJECT_STRUCTURE_AUTO.md
git commit -m "chore: обновление структуры проекта"
```

## Troubleshooting

### Скрипт не запускается

Убедитесь, что Python 3 установлен:

```bash
python3 --version
```

Если скрипт не исполняемый:

```bash
chmod +x scripts/generate-project-structure.py
```

### Pre-commit hook не работает

Проверьте, что hook установлен и исполняемый:

```bash
ls -la .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

Или переустановите hooks:

```bash
./scripts/setup-git-hooks.sh
```

### CI не обновляет структуру

Проверьте:
1. Что workflow файл `.github/workflows/ci.yml` содержит job `update-structure`
2. Что у workflow есть права `contents: write`
3. Логи GitHub Actions для выявления ошибок

## Рекомендации

1. **Всегда обновляйте структуру** при изменении структуры проекта
2. **Не редактируйте** `PROJECT_STRUCTURE_AUTO.md` вручную
3. **Используйте pre-commit hook** для автоматической проверки
4. **Проверяйте CI логи** при проблемах с автоматическим обновлением

## Связанные файлы

- `PROJECT_STRUCTURE_AUTO.md` - автоматически генерируемая структура
- `PROJECT_STRUCTURE.md` - ручная документация структуры (можно редактировать)
- `scripts/generate-project-structure.py` - скрипт генерации
- `scripts/setup-git-hooks.sh` - скрипт установки git hooks
- `.github/workflows/ci.yml` - CI workflow с автоматическим обновлением

