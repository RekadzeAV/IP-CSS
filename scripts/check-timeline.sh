#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ TIMELINE.md
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/check-timeline.sh

set -e

TIMELINE_FILE="TIMELINE.md"
GUIDE_FILE="docs/TIMELINE_GUIDE.md"

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª—ã –ø—Ä–æ–µ–∫—Ç–∞..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
if [ ! -f "$TIMELINE_FILE" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: $TIMELINE_FILE –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "   –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞."
    echo "   –°–º. —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: $GUIDE_FILE"
    exit 1
fi
echo "‚úÖ $TIMELINE_FILE –Ω–∞–π–¥–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
echo ""
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã..."

REQUIRED_SECTIONS=("–í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞ IP-CSS" "–ü—Ä–æ—à–ª–æ–µ" "–ù–∞—Å—Ç–æ—è—â–µ–µ" "–ë—É–¥—É—â–µ–µ")
MISSING_SECTIONS=()

for section in "${REQUIRED_SECTIONS[@]}"; do
    if ! grep -q "$section" "$TIMELINE_FILE"; then
        MISSING_SECTIONS+=("$section")
    fi
done

if [ ${#MISSING_SECTIONS[@]} -gt 0 ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –í TIMELINE.md –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:"
    for section in "${MISSING_SECTIONS[@]}"; do
        echo "   - $section"
    done
    exit 1
fi
echo "‚úÖ –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –æ—à–∏–±–∫–∞)
echo ""
echo "üìÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è..."
if grep -q "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ" "$TIMELINE_FILE"; then
    CURRENT_YEAR=$(date +%Y)
    CURRENT_MONTH=$(date +%B)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Ñ–∞–π–ª —Ç–µ–∫—É—â–∏–π –≥–æ–¥ –≤ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    if grep -q "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.*$CURRENT_YEAR" "$TIMELINE_FILE" || \
       grep -q "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.*$(date +%Y-%m)" "$TIMELINE_FILE"; then
        echo "‚úÖ –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞"
    else
        echo "‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –î–∞—Ç–∞ '–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ' –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π"
        echo "   –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –ø—Ä–∏ –∑–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö"
    fi
else
    echo "‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –í TIMELINE.md –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–∞—Ç–∞ '–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ'"
    echo "   –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—É –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
echo ""
echo "üîó –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫..."
if grep -q "TIMELINE_GUIDE.md\|CHANGELOG.md\|CURRENT_STATUS.md\|DEVELOPMENT_ROADMAP.md" "$TIMELINE_FILE"; then
    echo "‚úÖ –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç"
else
    echo "‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã"
fi

echo ""
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
echo ""
echo "üí° –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–º. $GUIDE_FILE"

