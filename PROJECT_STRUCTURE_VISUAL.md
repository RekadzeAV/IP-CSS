# Визуальная схема структуры проекта IP-CSS

## Быстрая навигация

```
┌─────────────────────────────────────────────────────────────────┐
│                    IP Camera Surveillance System                 │
│                          (IP-CSS)                                │
└─────────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│   CLIENT     │    │    SERVER    │    │    NATIVE    │
│   LAYER      │    │    LAYER     │    │    LAYER     │
└──────────────┘    └──────────────┘    └──────────────┘
        │                     │                     │
        │                     │                     │
┌───────┴────────┐    ┌───────┴────────┐    ┌───────┴────────┐
│ Android (25%)  │    │ REST API (30%) │    │ Video Proc (5%)│
│ iOS (0%)       │    │ Web UI (25%)   │    │ Analytics (5%) │
│ Desktop (0%)   │    │                │    │ Codecs (5%)    │
└────────────────┘    └────────────────┘    └────────────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │  SHARED (KMM)   │
                    │  Business Logic │
                    │   Domain Layer  │
                    └────────┬────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
        ▼                    ▼                    ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│ CORE:NETWORK │    │ CORE:COMMON  │    │ CORE:LICENSE │
│   (40%)      │    │    (100%)    │    │    (20%)     │
└──────────────┘    └──────────────┘    └──────────────┘
```

---

## Модульная структура

### 📱 Client Applications

```
┌─────────────────────────────────────────┐
│         CLIENT APPLICATIONS              │
├─────────────────────────────────────────┤
│                                          │
│  ┌──────────┐  ┌──────────┐  ┌─────────┐│
│  │ Android  │  │   iOS    │  │ Desktop ││
│  │   25%    │  │    0%    │  │    0%   ││
│  └──────────┘  └──────────┘  └─────────┘│
│       │            │            │        │
│       └────────────┼────────────┘        │
│                    │                     │
│              ┌─────▼──────┐             │
│              │   shared/  │             │
│              │    (KMM)   │             │
│              └────────────┘             │
└─────────────────────────────────────────┘
```

### 🧩 Shared Module (KMM)

```
┌─────────────────────────────────────────┐
│            SHARED MODULE                │
├─────────────────────────────────────────┤
│                                          │
│  ┌────────────────────────────────────┐ │
│  │         DOMAIN LAYER (30%)         │ │
│  │  • Models: Camera, Event, etc.     │ │
│  │  • Use Cases: Camera operations    │ │
│  │  • Repository Interfaces           │ │
│  └────────────────────────────────────┘ │
│                  │                      │
│  ┌────────────────────────────────────┐ │
│  │          DATA LAYER (50%)          │ │
│  │  • CameraRepositoryImpl ✅         │ │
│  │  • Other Repos ⚠️                  │ │
│  │  • SQLDelight Database             │ │
│  └────────────────────────────────────┘ │
│                  │                      │
│  ┌────────────────────────────────────┐ │
│  │        COMMON UTILITIES            │ │
│  │  • BackgroundWorker                │ │
│  │  • FileSystem                      │ │
│  │  • NotificationManager             │ │
│  └────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 🔌 Core Modules

```
┌─────────────────────────────────────────┐
│           CORE MODULES                  │
├─────────────────────────────────────────┤
│                                          │
│  ┌──────────────┐  ┌──────────────┐    │
│  │  CORE:NETWORK│  │ CORE:COMMON  │    │
│  │     (40%)    │  │   (100%)     │    │
│  │              │  │              │    │
│  │ • ApiClient  │  │ • Resolution │    │
│  │ • OnvifClient│  │ • CameraStatus│   │
│  │ • RTSP ⚠️    │  │ • Validators │    │
│  │ • WebSocket ⚠️│  │              │    │
│  └──────────────┘  └──────────────┘    │
│                                          │
│  ┌────────────────────────────────────┐ │
│  │        CORE:LICENSE (20%)          │ │
│  │  • LicenseManager ⚠️               │ │
│  │  • Platform-specific implementations││
│  └────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 🖥️ Server Layer

```
┌─────────────────────────────────────────┐
│           SERVER LAYER                  │
├─────────────────────────────────────────┤
│                                          │
│  ┌────────────────────────────────────┐ │
│  │      SERVER/API (Ktor) (30%)       │ │
│  │  • CameraRoutes ✅                 │ │
│  │  • HealthRoutes ✅                 │ │
│  │  • Auth ❌                         │ │
│  │  • WebSocket ❌                    │ │
│  └────────────────────────────────────┘ │
│                  │                      │
│  ┌────────────────────────────────────┐ │
│  │    SERVER/WEB (Next.js) (25%)      │ │
│  │  • Camera pages ✅                 │ │
│  │  • Dashboard ⚠️                    │ │
│  │  • Events ❌                       │ │
│  │  • Recordings ❌                   │ │
│  │  • Video Player ❌                 │ │
│  └────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### ⚙️ Native Libraries (C++)

```
┌─────────────────────────────────────────┐
│       NATIVE LIBRARIES (C++)            │
├─────────────────────────────────────────┤
│                                          │
│  ┌──────────────┐  ┌──────────────┐    │
│  │VIDEO-PROC    │  │  ANALYTICS   │    │
│  │    (5%)      │  │    (5%)      │    │
│  │              │  │              │    │
│  │ • RTSP       │  │ • Motion Det │    │
│  │ • Decoder    │  │ • Object Det │    │
│  │ • Encoder    │  │ • Face Det   │    │
│  │ • Processor  │  │ • ANPR       │    │
│  └──────────────┘  └──────────────┘    │
│                                          │
│  ┌────────────────────────────────────┐ │
│  │           CODECS (5%)              │ │
│  │  • H.264                           │ │
│  │  • H.265                           │ │
│  │  • MJPEG                           │ │
│  └────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## Потоки данных

### Добавление камеры

```
┌──────────┐
│   UI     │
│ (Android)│
└────┬─────┘
     │
     ▼
┌──────────────┐
│ Use Case     │
│ AddCamera    │
└────┬─────────┘
     │
     ▼
┌──────────────┐     ┌──────────────┐
│ Repository   │────▶│  SQLDelight  │
│ CameraRepo   │     │   Database   │
└────┬─────────┘     └──────────────┘
     │
     ▼
┌──────────────┐
│ OnvifClient  │
│ testConnection│
└──────────────┘
```

### Просмотр видео потока

```
┌──────────┐
│   UI     │
└────┬─────┘
     │
     ▼
┌──────────────┐     ┌──────────────┐
│ CameraRepo   │────▶│  RTSP Client │
│ getStreamUri │     │   (⚠️ 10%)   │
└──────────────┘     └──────┬───────┘
                            │
                            ▼
                    ┌──────────────┐
                    │ Native C++   │
                    │ RTSP Handler │
                    │   (❌ 5%)    │
                    └──────────────┘
```

---

## Статус по компонентам

### ✅ Полностью реализовано (100%)
- Инфраструктура проекта
- Core:Common модуль
- Доменные модели
- ApiClient
- SQLDelight схема для Camera
- CameraRepositoryImpl
- Camera Use Cases
- REST API эндпоинты для камер

### 🟡 Частично реализовано (25-80%)
- **Android UI** (25%) - базовая структура
- **Web UI** (25%) - камеры реализованы, остальное требуется
- **Сетевой слой** (40%) - ApiClient готов, остальное частично
- **Сервер API** (30%) - камеры готовы, остальное требуется
- **Доменный слой** (30%) - камеры готовы, остальное требуется
- **Слой данных** (50%) - Camera готов, остальное требуется
- **OnvifClient** (40%) - базовая функциональность
- **WebSocketClient** (80%) - базовая функциональность
- **License** (20%) - структура есть, функциональность требует реализации

### ❌ Не реализовано (0-10%)
- **iOS UI** (0%)
- **Desktop UI** (0%)
- **RTSP Client** (10%) - только обертка
- **Native Libraries** (5%) - только заголовки
- **Video Recording** (0%)
- **AI Analytics** (0%)
- **Authentication** (0%)

---

## Легенда статусов

- ✅ **100%** - Полностью реализовано и протестировано
- 🟡 **25-80%** - Частично реализовано, требует доработки
- ⚠️ **0-20%** - Начато, требует значительной работы
- ❌ **0%** - Не начато

---

**Последнее обновление:** Январь 2025
